<%- include('../partials/header') %>

<div class="checkout-container">
    <div class="row">
        <div class="col-md-8">
            <!-- Delivery Address Section -->
            <div class="mb-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="section-title m-0">Delivery Address</h4>
                </div>
                
                <div class="address-selector">
                    <% if (addresses && addresses.length > 0) { %>
                        <!-- Selected Address Preview -->
                        <div class="address-preview" data-bs-toggle="modal" data-bs-target="#addressListModal" 
                             data-address-id="<%= addresses[0]._id %>">
                            <div class="address-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="address-details selected-address-details">
                                <h5><%= addresses[0].name %></h5>
                                <p><%= addresses[0].street %></p>
                                <p><%= addresses[0].city %>, <%= addresses[0].state %> <%= addresses[0].pinCode %></p>
                                <p class="mb-0"><i class="fas fa-phone"></i> <%= addresses[0].phoneNumber %></p>
                            </div>
                            <button type="button" class="change-address-btn">
                                Change
                            </button>
                        </div>
                        <!-- Hidden input for selected address -->
                        <input type="hidden" name="selectedAddress" value="<%= addresses[0]._id %>">
                    <% } %>
                </div>
                
                <% if (!addresses || addresses.length === 0) { %>
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>No addresses found. Please add a delivery address.
                    </div>
                <% } %>
            </div>

            <!-- Order Items Section -->
            <div class="mb-4">
                <h4 class="section-title mb-3">Order Items</h4>
                <div class="cart-items">
                    <% cart.items.forEach(item => { %>
                        <div class="cart-item">
                            <img src="<%= item.product.image %>" alt="<%= item.product.name %>" class="cart-item-image">
                            <div class="cart-item-details flex-grow-1">
                                <h5><%= item.product.name %></h5>
                                <p class="text-muted mb-2">Quantity: <%= item.quantity %></p>
                                <p class="price mb-0">₹<%= item.product.price * item.quantity %></p>
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
        </div>

        <!-- Order Summary Section -->
        <div class="col-md-4">
            <div class="order-summary-card">
                <h4>Order Summary</h4>
                <div class="price-row">
                    <span>Subtotal</span>
                    <span>₹<%= cart.subtotal %></span>
                </div>
                <div class="price-row">
                    <span>Shipping</span>
                    <span class="free-shipping-badge">FREE</span>
                </div>
                <div class="price-row">
                    <span>Tax (5%)</span>
                    <span>₹<%= cart.tax %></span>
                </div>
                <div class="price-row total-row">
                    <span>Total Amount</span>
                    <span class="total-price">₹<%= cart.total %></span>
                </div>
                <button id="placeOrderBtn" class="btn btn-primary">
                    <i class="fas fa-shopping-bag me-2"></i>Place Order
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Address List Modal -->
<div class="modal fade" id="addressListModal" tabindex="-1" aria-labelledby="addressListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addressListModalLabel">Select Delivery Address</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <% if (addresses && addresses.length > 0) { %>
                    <div class="address-list">
                        <% addresses.forEach(function(address) { %>
                            <div class="address-option" data-address-id="<%= address._id %>">
                                <div class="address-details">
                                    <h5><%= address.name %></h5>
                                    <p><%= address.street %></p>
                                    <p><%= address.city %>, <%= address.state %> <%= address.pinCode %></p>
                                    <p class="mb-0"><i class="fas fa-phone"></i> <%= address.phoneNumber %></p>
                                </div>
                            </div>
                        <% }); %>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary" onclick="selectAddress()">Select Address</button>
                    </div>
                <% } else { %>
                    <div class="text-center p-4">
                        <i class="fas fa-home fa-3x mb-3"></i>
                        <h5>No Addresses Found</h5>
                        <p>Please add a delivery address to continue.</p>
                    </div>
                <% } %>
            </div>
        </div>
    </div>
</div>

<%- include('../partials/footer') %>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/user/checkout.js"></script>
